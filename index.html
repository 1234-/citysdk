

<!DOCTYPE html>
<html>
  <head>
    <title>CitySDK Demo</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 100%;
        
        margin: 0px;
        padding: 0px
      }
      ul.ui-autocomplete {
        list-style: none;
    }   
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
    <script src="js/vendor/jquery/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="/ajcl/v1.1/"></script>
    <script type="text/javascript" src="js/citysdk.js"></script>
    <script src="js/citysdk.census.js"></script>
    <script>
        $(document).ready(function(){        
        var censusauto = census(".auto");
            censusauto.autocomplete({
               search: function( event, ui ) {
                   var zip = $("#zip").val();
                   census(this).autocomplete("option", "source", "/citySDK/data/citySDK.php/search/?zips=" + zip);
               },
               messages : {
                    noResults : 'No results found.',
                    results : function(count) {
                        return "";
                    }
                },
                select: function(event,ui){
                    var fips = (ui.item.value);
                    var test = new CitySDK();
//Your census data api key needs to be added to this enable function  "key"
        test.modules.census.enable();
        var mapRequest = {
        		"fips":fips,
                        "level": "tract",            
                        "variables": ["income",
                                     "poverty", 
                                      "population"
                                   ]};        
        test.modules.census.GEORequest(mapRequest,function(data){
            // Load GeoJSON.
           map.data.addGeoJson(data);
            });
                },
                minLength: 3,
                delay: 750
       });
       census("#search").bind("click",function(){
           alert(census("#zip").val());
       });
   });
        google.maps.event.addDomListener(window, 'load', initialize);
    	var map;
        

    function initialize() {
      map = new google.maps.Map(document.getElementById('map-canvas'), {
        zoom: 12,
        center: {lat: 38.9047, lng: -77.0164}
      });
      google.maps.event.addListener(map,'click', function(event){
          var latitude = event.latLng.k;
          var longitude = event.latLng.D;
          var test = new CitySDK();
          test.modules.census.enable();
          var request = {"lat": latitude, 
                "lng": longitude,
                "level": "tract", 
                "variables": ["income", "poverty", "age"]};
            test.modules.census.APIRequest(request,function(data){
            alert("State fips is: " + data.state + "\nTract fips is: " + data.state + data.tract + "\nYear :" + data.year + "\nIncome: " + data.data.income + "\nPoverty: " + data.data.poverty + "\nAge: " + data.data.age);       
            });      
      });
      // [START snippet]
      // User clicks and an infobox with the values request from api display
      map.data.addListener('click', function(event) {
          latitude = event.latLng.k;
          longitude = event.latLng.D;      
          var fips = event.feature.getProperty('STATEFP') + event.feature.getProperty('COUNTYFP') + event.feature.getProperty('TRACTCE');
          var place = event.feature.getProperty('NAME');
          var income = event.feature.getProperty('income');
          var population = event.feature.getProperty('population');
          var poverty = event.feature.getProperty('poverty');
          infowindow = new google.maps.InfoWindow({
            position:{lat:event.latLng.k,lng:event.latLng.D},
            content:"Name: " + place + "<br>Fips: " + fips + "<br> Population: " + population + "<br> Poverty: " + poverty + "<br>Income: " + income
        });
         infowindow.open(map);
      });

      
      map.data.addListener('mouseover', function(event) {

      });

      map.data.addListener('mouseout', function(event) {
          //infowindow.close();
      });
    }

    </script>
  </head>
  <body>
      <div style="height:10%;">
          <label>Zip Code:</label>
          <input id="zip" class="auto" type="text"/>        
      </div>
    <div id="map-canvas"></div>    
  </body>
</html>

