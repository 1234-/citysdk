{"version":3,"file":"shadow.test.env.js","sources":["shadow/test/env.cljs"],"mappings":"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","names":["cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$4","shadow.test.env/tests-ref","cljs.core/assoc","shadow.test.env/register-fixtures","test-ns","type","fix","cljs.core/assoc-in","test-name","test-var","cljs.core.reduce.cljs$core$IFn$_invoke$arity$3","cljs.core/+","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$variadic","cljs.core/update","cljs.core/dissoc","ns","cljs.core/deref","cljs.core.get.cljs$core$IFn$_invoke$arity$2","js/Error","shadow.test.env/get-test-ns-info","event-fn","shadow.test.env/register-test","cljs.core/chunk-first","s__22191","cljs.core/keys","shadow.test.env/get-test-count","iter__4324__auto__","cljs.core/LazySeq","temp__5457__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4322__auto__","size__4323__auto__","cljs.core/count","b__22193","cljs.core/chunk-buffer","i__22192","map__22194","cljs.core._nth.cljs$core$IFn$_invoke$arity$2","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__22190","cljs.core/chunk-rest","map__22196","cljs.core/first","cljs.core/cons","cljs.core/rest","vars","cljs.core/vals","js/shadow","js/shadow.test","js/shadow.test.env","js/shadow.test.env.tests-ref","cljs.core.atom.cljs$core$IFn$_invoke$arity$1","cljs.core/Symbol","cljs.core/not","js/goog.global.SHADOW_NS_RESET","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","shadow.test.env/get-tests","shadow.test.env/get-test-namespaces"],"sourcesContent":["(ns shadow.test.env)\n\n;; this should be how cljs.test works out of the box IMHO\n;; all those macros don't compose and make writing testing utilities painful\n;; (eg. you have to recompile the namespace containing the macro to pick up new tests)\n;; only the macros were replaced, the functionality remains unchanged\n(defonce tests-ref (atom {:namespaces {}}))\n\n(when-not (:hooked @tests-ref)\n  ;; we want to remove all tests when a ns is reloaded\n  ;; since otherwise deleted tests stay in the atom\n  ;; the event is dispatched by shadow.cljs.devtools.client.env\n  ;; right before the source is loaded\n  (let [event-fn\n        (fn [ns]\n          (swap! tests-ref update :namespaces dissoc ns))]\n\n    (if-not js/goog.global.SHADOW_NS_RESET\n      (set! js/goog.global.SHADOW_NS_RESET [event-fn])\n      (set! js/goog.global.SHADOW_NS_RESET (conj js/goog.global.SHADOW_NS_RESET event-fn)))\n    (swap! tests-ref assoc :hooked true)))\n\n(defn register-test [test-ns test-name test-var]\n  ;; register by name so reloading replaces the old test\n  (swap! tests-ref assoc-in [:namespaces test-ns :vars test-name] test-var)\n  test-var)\n\n(defn register-fixtures [test-ns type fix]\n  (swap! tests-ref assoc-in [:namespaces test-ns :fixtures type] fix))\n\n(defn get-tests []\n  (get @tests-ref :namespaces))\n\n(defn get-test-ns-info [ns]\n  {:pre [(symbol? ns)]}\n  (get-in @tests-ref [:namespaces ns]))\n\n(defn get-test-namespaces\n  \"returns all the registered test namespaces and symbols\n   use (get-test-ns-info the-sym) to get the details\"\n  []\n  (-> @tests-ref (:namespaces) (keys)))\n\n(defn get-test-count []\n  (->> (for [{:keys [vars] :as test-ns} (-> @tests-ref (:namespaces) (vals))]\n         (count vars))\n       (reduce + 0)))"]}