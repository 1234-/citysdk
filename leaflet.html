<html>
<head>
	<title>Leaflet CitySDK Example</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	 <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
         <style>
             .info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}
         </style>
</head>
<body>
	<div id="map" style="width: 800px; height: 600px"></div>
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <script src="js/vendor/jquery/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="js/citysdk.js"></script>
        <script src="js/citysdk.census.js"></script>
	<script>
                    var map = L.map('map',{
                        center : [38.9047, -77.0164],
                        zoom: 11
                    });
                    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                    }).addTo(map);
                    // control that shows state info on hover
		var info = L.control();
		info.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'info');
			this.update();
			return this._div;
		};
                info.update = function (props) {
			this._div.innerHTML = '<h4>CitySDK Demo</h4>' +  (props ?
				'<b>Name: ' + props.NAME + '</b><br />Fips: ' + props.STATEFP + props.COUNTYFP + props.TRACTCE + '<br> Population: ' + props.population + '<br>Poverty: ' + props.poverty + '<br>Income: ' + props.income
				: 'Hover over a geography');
		};
                function style(feature) {
			return {
				weight: 2,
				opacity: 1,
				color: '#666',
				dashArray: '3',
				fillOpacity: 0.7,
                                fillColor: '#ADD8E6'
			};
		}
		info.addTo(map);
                function highlightFeature(e) {
			var layer = e.target;

			layer.setStyle({
				weight: 5,
                                color: '#666',
				opacity:.75
			});
			if (!L.Browser.ie && !L.Browser.opera) {
				layer.bringToFront();
			}
			info.update(layer.feature.properties);
		}
                var geojson;                
                function resetHighlight(e) {
                    geojson.resetStyle(e.target);
                    info.update();
                }
                function onEachFeature(feature, layer) {
                    layer.on({
                        mouseover: highlightFeature,
                        mouseout: resetHighlight
                        });
                }               
                    var test = new CitySDK();
// Your census data api key needs to be added to this enable function ("key)
                    test.modules.census.enable();
                    var dataRequest = {
                                "lat": 38.9047, 
                                "lng": -77.0164,            
                                "level": "tract",            
                                "variables": ["income"
                                              //"poverty", 
                                              //"age"
                                              ]};
                    var mapRequest = {
                            "fips":"1150000",
                            "level": "tract",            
                            "variables": ["income",
                                          "poverty", 
                                          "population"
                                          ]};
                     test.modules.census.GEORequest(mapRequest,function(data){
                     geojson = L.geoJson(data, {
                        style: style,
			onEachFeature: onEachFeature
		}).addTo(map);
            });
	</script>
</body>
</html>
